<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reservas - Restaurante</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Interface Cliente */
        .client-view {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 40px);
        }

        .reservation-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .datetime-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        /* ConfirmaÃ§Ã£o */
        .confirmation {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.5s ease;
        }

        .confirmation h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .confirmation p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        #qrcode {
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            display: inline-block;
        }

        .btn-new {
            background: #4CAF50;
            margin-top: 20px;
        }

        /* Interface Host */
        .host-view {
            display: none;
        }

        .host-header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .host-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            margin: 0;
            font-weight: 600;
        }

        .filter-group input, .filter-group select {
            width: auto;
            padding: 8px 12px;
        }

        .reservations-grid {
            display: grid;
            gap: 20px;
        }

        .reservation-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .reservation-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .reservation-info {
            flex: 1;
        }

        .reservation-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .reservation-details {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }

        .reservation-actions {
            display: flex;
            gap: 10px;
        }

        .btn-action {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-confirm {
            background: #4CAF50;
            color: white;
        }

        .btn-checkin {
            background: #2196F3;
            color: white;
        }

        .btn-noshow {
            background: #f44336;
            color: white;
        }

        .btn-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-pending {
            background: #FFF3E0;
            color: #F57C00;
        }

        .status-confirmed {
            background: #E8F5E9;
            color: #388E3C;
        }

        .status-present {
            background: #E3F2FD;
            color: #1976D2;
        }

        .status-noshow {
            background: #FFEBEE;
            color: #C62828;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .empty-state h3 {
            color: #999;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: #bbb;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .datetime-group {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .reservation-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .reservation-actions {
                margin-top: 15px;
                width: 100%;
            }

            .btn-action {
                flex: 1;
            }
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
        }

        .loading::after {
            content: "...";
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Interface Cliente -->
        <div class="client-view" id="clientView">
            <div class="reservation-card" id="reservationForm">
                <h1>Reserve sua Mesa</h1>
                <p class="subtitle">Preencha os dados abaixo para fazer sua reserva</p>
                
                <form id="bookingForm">
                    <div class="form-group">
                        <label for="name">Nome Completo</label>
                        <input type="text" id="name" required placeholder="Digite seu nome">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">Telefone</label>
                        <input type="tel" id="phone" required placeholder="(11) 98765-4321">
                    </div>
                    
                    <div class="datetime-group">
                        <div class="form-group">
                            <label for="date">Data</label>
                            <input type="date" id="date" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="time">HorÃ¡rio</label>
                            <select id="time" required>
                                <option value="">Selecione</option>
                                <option value="11:00">11:00</option>
                                <option value="11:30">11:30</option>
                                <option value="12:00">12:00</option>
                                <option value="12:30">12:30</option>
                                <option value="13:00">13:00</option>
                                <option value="13:30">13:30</option>
                                <option value="14:00">14:00</option>
                                <option value="18:00">18:00</option>
                                <option value="18:30">18:30</option>
                                <option value="19:00">19:00</option>
                                <option value="19:30">19:30</option>
                                <option value="20:00">20:00</option>
                                <option value="20:30">20:30</option>
                                <option value="21:00">21:00</option>
                                <option value="21:30">21:30</option>
                                <option value="22:00">22:00</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="people">NÃºmero de Pessoas</label>
                        <select id="people" required>
                            <option value="">Selecione</option>
                            <option value="1">1 pessoa</option>
                            <option value="2">2 pessoas</option>
                            <option value="3">3 pessoas</option>
                            <option value="4">4 pessoas</option>
                            <option value="5">5 pessoas</option>
                            <option value="6">6 pessoas</option>
                            <option value="7">7 pessoas</option>
                            <option value="8">8 pessoas</option>
                            <option value="9">9 pessoas</option>
                            <option value="10">10+ pessoas</option>
                        </select>
                    </div>
                    
                    <button type="submit">Fazer Reserva</button>
                </form>
            </div>
        </div>

        <!-- Interface Host -->
        <div class="host-view" id="hostView">
            <div class="host-header">
                <div class="host-title">
                    <h1>Painel de Reservas</h1>
                    <div id="currentDateTime"></div>
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="filterDate">Data:</label>
                        <input type="date" id="filterDate">
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterTime">HorÃ¡rio:</label>
                        <select id="filterTime">
                            <option value="">Todos</option>
                            <option value="11:00">11:00</option>
                            <option value="11:30">11:30</option>
                            <option value="12:00">12:00</option>
                            <option value="12:30">12:30</option>
                            <option value="13:00">13:00</option>
                            <option value="13:30">13:30</option>
                            <option value="14:00">14:00</option>
                            <option value="18:00">18:00</option>
                            <option value="18:30">18:30</option>
                            <option value="19:00">19:00</option>
                            <option value="19:30">19:30</option>
                            <option value="20:00">20:00</option>
                            <option value="20:30">20:30</option>
                            <option value="21:00">21:00</option>
                            <option value="21:30">21:30</option>
                            <option value="22:00">22:00</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filterStatus">Status:</label>
                        <select id="filterStatus">
                            <option value="">Todos</option>
                            <option value="pending">Pendente</option>
                            <option value="confirmed">Confirmada</option>
                            <option value="present">Presente</option>
                            <option value="noshow">NÃ£o Compareceu</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="reservations-grid" id="reservationsList">
                <div class="loading">Carregando reservas</div>
            </div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script>
        // ConfiguraÃ§Ã£o do Firebase (adicione suas credenciais aqui)
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID"
        };

        // Inicializar Firebase (serÃ¡ ativado quando vocÃª adicionar as credenciais)
        let db = null;
        if (firebaseConfig.apiKey !== "SUA_API_KEY") {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
        }

        // Sistema de armazenamento local para demonstraÃ§Ã£o
        class LocalStorage {
            constructor() {
                this.reservations = this.loadReservations();
            }

            loadReservations() {
                const stored = localStorage.getItem('reservations');
                return stored ? JSON.parse(stored) : [];
            }

            saveReservations() {
                localStorage.setItem('reservations', JSON.stringify(this.reservations));
            }

            addReservation(data) {
                const reservation = {
                    ...data,
                    id: Date.now().toString(),
                    createdAt: new Date().toISOString()
                };
                this.reservations.push(reservation);
                this.saveReservations();
                return Promise.resolve(reservation);
            }

            getReservations(filters = {}) {
                let filtered = [...this.reservations];
                
                if (filters.date) {
                    filtered = filtered.filter(r => r.date === filters.date);
                }
                if (filters.time) {
                    filtered = filtered.filter(r => r.time === filters.time);
                }
                if (filters.status) {
                    filtered = filtered.filter(r => r.status === filters.status);
                }
                
                // Ordenar por data e hora
                filtered.sort((a, b) => {
                    const dateCompare = a.date.localeCompare(b.date);
                    if (dateCompare !== 0) return dateCompare;
                    return a.time.localeCompare(b.time);
                });
                
                return Promise.resolve(filtered);
            }

            updateReservation(id, updates) {
                const index = this.reservations.findIndex(r => r.id === id);
                if (index !== -1) {
                    this.reservations[index] = { ...this.reservations[index], ...updates };
                    this.saveReservations();
                }
                return Promise.resolve();
            }

            onSnapshot(callback) {
                // Simular real-time updates
                setInterval(() => {
                    this.getReservations().then(callback);
                }, 1000);
                
                // Chamar imediatamente
                this.getReservations().then(callback);
            }
        }

        // Usar armazenamento local se Firebase nÃ£o estiver configurado
        const storage = db ? null : new LocalStorage();

        // Controle de visualizaÃ§Ã£o
        const urlParams = new URLSearchParams(window.location.search);
        const isHostView = urlParams.get('view') === 'host';

        if (isHostView) {
            document.getElementById('clientView').style.display = 'none';
            document.getElementById('hostView').style.display = 'block';
            initHostView();
        } else {
            initClientView();
        }

        // Interface Cliente
        function initClientView() {
            // Definir data mÃ­nima como hoje
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').min = today;
            document.getElementById('date').value = today;

            // Formatar campo de telefone
            document.getElementById('phone').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 0) {
                    if (value.length <= 11) {
                        value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                    }
                    e.target.value = value;
                }
            });

            // SubmissÃ£o do formulÃ¡rio
            document.getElementById('bookingForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const reservation = {
                    name: document.getElementById('name').value,
                    phone: document.getElementById('phone').value,
                    date: document.getElementById('date').value,
                    time: document.getElementById('time').value,
                    people: document.getElementById('people').value,
                    status: 'pending'
                };

                try {
                    let reservationId;
                    
                    if (db) {
                        // Salvar no Firebase
                        const docRef = await db.collection('reservations').add({
                            ...reservation,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        reservationId = docRef.id;
                    } else {
                        // Salvar localmente
                        const result = await storage.addReservation(reservation);
                        reservationId = result.id;
                    }

                    // Mostrar confirmaÃ§Ã£o
                    showConfirmation(reservation, reservationId);
                } catch (error) {
                    console.error('Erro ao fazer reserva:', error);
                    alert('Erro ao processar reserva. Por favor, tente novamente.');
                }
            });
        }

        function showConfirmation(reservation, reservationId) {
            const formattedDate = new Date(reservation.date + 'T00:00:00').toLocaleDateString('pt-BR');
            
            document.getElementById('reservationForm').innerHTML = `
                <div class="confirmation">
                    <h2>âœ“ Reserva Confirmada!</h2>
                    <p><strong>Nome:</strong> ${reservation.name}</p>
                    <p><strong>Data:</strong> ${formattedDate}</p>
                    <p><strong>HorÃ¡rio:</strong> ${reservation.time}</p>
                    <p><strong>Pessoas:</strong> ${reservation.people}</p>
                    <p><strong>Telefone:</strong> ${reservation.phone}</p>
                    <p style="color: #999; font-size: 14px; margin-top: 20px;">
                        CÃ³digo da reserva: #${reservationId.substring(0, 8).toUpperCase()}
                    </p>
                    <div id="qrcode"></div>
                    <p style="color: #666; font-size: 13px;">
                        Salve este QR Code para apresentar na entrada
                    </p>
                    <button class="btn-new" onclick="location.reload()">
                        Fazer Nova Reserva
                    </button>
                </div>
            `;

            // Gerar QR Code
            const qrData = JSON.stringify({
                id: reservationId,
                name: reservation.name,
                date: reservation.date,
                time: reservation.time,
                people: reservation.people
            });

            new QRCode(document.getElementById("qrcode"), {
                text: qrData,
                width: 200,
                height: 200,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // Interface Host
        function initHostView() {
            // Mostrar data/hora atual
            function updateDateTime() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                document.getElementById('currentDateTime').textContent = 
                    now.toLocaleDateString('pt-BR', options);
            }
            updateDateTime();
            setInterval(updateDateTime, 60000);

            // Definir filtro de data para hoje
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filterDate').value = today;

            // Configurar listeners dos filtros
            document.getElementById('filterDate').addEventListener('change', loadReservations);
            document.getElementById('filterTime').addEventListener('change', loadReservations);
            document.getElementById('filterStatus').addEventListener('change', loadReservations);

            // Carregar reservas
            if (db) {
                // Real-time updates do Firebase
                db.collection('reservations')
                    .onSnapshot(() => {
                        loadReservations();
                    });
            } else {
                // Updates locais
                storage.onSnapshot(() => {
                    loadReservations();
                });
            }

            loadReservations();
        }

        async function loadReservations() {
            const filters = {
                date: document.getElementById('filterDate').value,
                time: document.getElementById('filterTime').value,
                status: document.getElementById('filterStatus').value
            };

            try {
                let reservations = [];

                if (db) {
                    // Buscar do Firebase
                    let query = db.collection('reservations');
                    
                    if (filters.date) {
                        query = query.where('date', '==', filters.date);
                    }
                    if (filters.time) {
                        query = query.where('time', '==', filters.time);
                    }
                    if (filters.status) {
                        query = query.where('status', '==', filters.status);
                    }

                    const snapshot = await query.get();
                    reservations = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    // Ordenar
                    reservations.sort((a, b) => {
                        const timeCompare = a.time.localeCompare(b.time);
                        if (timeCompare !== 0) return timeCompare;
                        return (a.createdAt?.seconds || 0) - (b.createdAt?.seconds || 0);
                    });
                } else {
                    // Buscar localmente
                    reservations = await storage.getReservations(filters);
                }

                displayReservations(reservations);
            } catch (error) {
                console.error('Erro ao carregar reservas:', error);
                document.getElementById('reservationsList').innerHTML = `
                    <div class="empty-state">
                        <h3>Erro ao carregar reservas</h3>
                        <p>Por favor, recarregue a pÃ¡gina</p>
                    </div>
                `;
            }
        }

        function displayReservations(reservations) {
            const container = document.getElementById('reservationsList');
            
            if (reservations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Nenhuma reserva encontrada</h3>
                        <p>Ajuste os filtros ou aguarde novas reservas</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = reservations.map(reservation => {
                const statusClass = `status-${reservation.status}`;
                const statusText = getStatusText(reservation.status);
                const formattedDate = new Date(reservation.date + 'T00:00:00').toLocaleDateString('pt-BR');
                
                return `
                    <div class="reservation-item">
                        <div class="reservation-info">
                            <div class="reservation-name">
                                ${reservation.name}
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <div class="reservation-details">
                                ðŸ“… ${formattedDate} Ã s ${reservation.time}<br>
                                ðŸ‘¥ ${reservation.people} pessoa${reservation.people > 1 ? 's' : ''}<br>
                                ðŸ“± ${reservation.phone}
                            </div>
                        </div>
                        <div class="reservation-actions">
                            <button class="btn-action btn-confirm" 
                                    onclick="updateStatus('${reservation.id}', 'confirmed')"
                                    ${reservation.status !== 'pending' ? 'disabled' : ''}>
                                Confirmar
                            </button>
                            <button class="btn-action btn-checkin" 
                                    onclick="updateStatus('${reservation.id}', 'present')"
                                    ${reservation.status !== 'confirmed' ? 'disabled' : ''}>
                                Check-in
                            </button>
                            <button class="btn-action btn-noshow" 
                                    onclick="updateStatus('${reservation.id}', 'noshow')"
                                    ${reservation.status === 'present' || reservation.status === 'noshow' ? 'disabled' : ''}>
                                NÃ£o Compareceu
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'Pendente',
                'confirmed': 'Confirmada',
                'present': 'Presente',
                'noshow': 'NÃ£o Compareceu'
            };
            return statusMap[status] || status;
        }

        async function updateStatus(reservationId, newStatus) {
            try {
                if (db) {
                    // Atualizar no Firebase
                    await db.collection('reservations').doc(reservationId).update({
                        status: newStatus,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } else {
                    // Atualizar localmente
                    await storage.updateReservation(reservationId, { status: newStatus });
                }
                
                // Recarregar lista
                loadReservations();
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
                alert('Erro ao atualizar status. Por favor, tente novamente.');
            }
        }
    </script>
</body>
</html>